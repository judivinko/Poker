<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Poker Lobby</title>
<link rel="stylesheet" href="/app.css">
<style>
body { background:#0b0d13; color:#e5e7eb; font-family:system-ui, sans-serif; }
.wrap { max-width:600px; margin:0 auto; padding:20px; }
h1 { text-align:center; margin-bottom:20px; }
.table-list { display:flex; flex-direction:column; gap:10px; }
.item { background:#111722; padding:12px; border-radius:10px; display:flex; justify-content:space-between; align-items:center; border:1px solid #1f2937; }
.btn { padding:6px 12px; border-radius:6px; background:#22d3ee; border:none; cursor:pointer; color:#000; font-weight:600; }
.btn:hover { opacity:.9; }
input, select { padding:6px; border-radius:6px; background:#111722; border:1px solid #334155; color:#e5e7eb; }
#make-box { display:none; background:#0008; position:fixed; inset:0; display:flex; align-items:center; justify-content:center; }
.modal { background:#111722; padding:20px; border-radius:12px; width:260px; border:1px solid #334155; display:flex; flex-direction:column; gap:12px; }
</style>
</head>
<body>

<div class="wrap">
  <h1>POKER LOBBY</h1>

  <button class="btn" id="btn-make">+ Napravi Sto</button>

  <div class="table-list" id="list">Loading...</div>
</div>

<!-- Modal za kreiranje stola -->
<div id="make-box">
  <div class="modal">
    <label>Broj mjesta (2-9):</label>
    <select id="seats">
      <option>2</option><option>3</option><option>4</option><option>5</option>
      <option>6</option><option>7</option><option>8</option><option>9</option>
    </select>
    <button class="btn" id="create">Kreiraj</button>
    <button class="btn" id="close-make" style="background:#444;color:#eee;">Zatvori</button>
  </div>
</div>

<script>
// --- Fetch & Render Lobby ---
async function loadTables(){
  const r = await fetch("/api/tables").then(r=>r.json());
  if(!r.ok) return;
  const box = document.getElementById("list");
  box.innerHTML = "";
  for(const t of r.tables){
    const div = document.createElement("div");
    div.className="item";
    div.innerHTML = `
      <div>Sto #${t.id} • ${t.players}/${t.seats} igrača</div>
      <button class="btn" onclick="goTable(${t.id})">Join</button>
    `;
    box.appendChild(div);
  }
}

function goTable(id){
  location.href = "/table?id=" + id;
}

// --- Create Table ---
document.getElementById("btn-make").onclick = ()=> {
  document.getElementById("make-box").style.display="flex";
};
document.getElementById("close-make").onclick = ()=> {
  document.getElementById("make-box").style.display="none";
};

document.getElementById("create").onclick = async ()=>{
  const seats = document.getElementById("seats").value;
  const r = await fetch("/api/table/create",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({seats:Number(seats)})
  }).then(r=>r.json());
  if(r.ok){
    location.href="/table?id="+r.table_id;
  }else alert(r.error||"Error");
};

// --- WebSocket auto refresh ---
const ws = new WebSocket((location.protocol==="https:"?"wss":"ws")+"://"+location.host);
ws.onmessage = msg=>{
  const data = JSON.parse(msg.data);
  if(data.type==="lobby") loadTables();
};

// initial load
loadTables();
</script>
</body>
</html>
